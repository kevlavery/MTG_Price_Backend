/*!
 * unpipe
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */

'use strict'

/**
 * Module exports.
 * @public
 */

module.exports = unpipe

/**
 * Determine if there are Node.js pipe-like data listeners.
 * @private
 */

function hasPipeDataListeners(stream) ***REMOVED***
  var listeners = stream.listeners('data')

  for (var i = 0; i < listeners.length; i++) ***REMOVED***
    if (listeners[i].name === 'ondata') ***REMOVED***
      return true
    ***REMOVED***
  ***REMOVED***

  return false
***REMOVED***

/**
 * Unpipe a stream from all destinations.
 *
 * @param ***REMOVED***object***REMOVED*** stream
 * @public
 */

function unpipe(stream) ***REMOVED***
  if (!stream) ***REMOVED***
    throw new TypeError('argument stream is required')
  ***REMOVED***

  if (typeof stream.unpipe === 'function') ***REMOVED***
    // new-style
    stream.unpipe()
    return
  ***REMOVED***

  // Node.js 0.8 hack
  if (!hasPipeDataListeners(stream)) ***REMOVED***
    return
  ***REMOVED***

  var listener
  var listeners = stream.listeners('close')

  for (var i = 0; i < listeners.length; i++) ***REMOVED***
    listener = listeners[i]

    if (listener.name !== 'cleanup' && listener.name !== 'onclose') ***REMOVED***
      continue
    ***REMOVED***

    // invoke the listener
    listener.call(stream)
  ***REMOVED***
***REMOVED***
