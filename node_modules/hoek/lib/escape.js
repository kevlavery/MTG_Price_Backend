'use strict';

// Declare internals

const internals = ***REMOVED******REMOVED***;


exports.escapeJavaScript = function (input) ***REMOVED***

    if (!input) ***REMOVED***
        return '';
    ***REMOVED***

    let escaped = '';

    for (let i = 0; i < input.length; ++i) ***REMOVED***

        const charCode = input.charCodeAt(i);

        if (internals.isSafe(charCode)) ***REMOVED***
            escaped += input[i];
        ***REMOVED***
        else ***REMOVED***
            escaped += internals.escapeJavaScriptChar(charCode);
        ***REMOVED***
    ***REMOVED***

    return escaped;
***REMOVED***;


exports.escapeHtml = function (input) ***REMOVED***

    if (!input) ***REMOVED***
        return '';
    ***REMOVED***

    let escaped = '';

    for (let i = 0; i < input.length; ++i) ***REMOVED***

        const charCode = input.charCodeAt(i);

        if (internals.isSafe(charCode)) ***REMOVED***
            escaped += input[i];
        ***REMOVED***
        else ***REMOVED***
            escaped += internals.escapeHtmlChar(charCode);
        ***REMOVED***
    ***REMOVED***

    return escaped;
***REMOVED***;


exports.escapeJson = function (input) ***REMOVED***

    if (!input) ***REMOVED***
        return '';
    ***REMOVED***

    const lessThan = 0x3C;
    const greaterThan = 0x3E;
    const andSymbol = 0x26;
    const lineSeperator = 0x2028;

    // replace method
    let charCode;
    return input.replace(/[<>&\u2028\u2029]/g, (match) => ***REMOVED***

        charCode = match.charCodeAt(0);

        if (charCode === lessThan) ***REMOVED***
            return '\\u003c';
        ***REMOVED***
        else if (charCode === greaterThan) ***REMOVED***
            return '\\u003e';
        ***REMOVED***
        else if (charCode === andSymbol) ***REMOVED***
            return '\\u0026';
        ***REMOVED***
        else if (charCode === lineSeperator) ***REMOVED***
            return '\\u2028';
        ***REMOVED***
        return '\\u2029';
    ***REMOVED***);
***REMOVED***;


internals.escapeJavaScriptChar = function (charCode) ***REMOVED***

    if (charCode >= 256) ***REMOVED***
        return '\\u' + internals.padLeft('' + charCode, 4);
    ***REMOVED***

    const hexValue = new Buffer(String.fromCharCode(charCode), 'ascii').toString('hex');
    return '\\x' + internals.padLeft(hexValue, 2);
***REMOVED***;


internals.escapeHtmlChar = function (charCode) ***REMOVED***

    const namedEscape = internals.namedHtml[charCode];
    if (typeof namedEscape !== 'undefined') ***REMOVED***
        return namedEscape;
    ***REMOVED***

    if (charCode >= 256) ***REMOVED***
        return '&#' + charCode + ';';
    ***REMOVED***

    const hexValue = new Buffer(String.fromCharCode(charCode), 'ascii').toString('hex');
    return '&#x' + internals.padLeft(hexValue, 2) + ';';
***REMOVED***;


internals.padLeft = function (str, len) ***REMOVED***

    while (str.length < len) ***REMOVED***
        str = '0' + str;
    ***REMOVED***

    return str;
***REMOVED***;


internals.isSafe = function (charCode) ***REMOVED***

    return (typeof internals.safeCharCodes[charCode] !== 'undefined');
***REMOVED***;


internals.namedHtml = ***REMOVED***
    '38': '&amp;',
    '60': '&lt;',
    '62': '&gt;',
    '34': '&quot;',
    '160': '&nbsp;',
    '162': '&cent;',
    '163': '&pound;',
    '164': '&curren;',
    '169': '&copy;',
    '174': '&reg;'
***REMOVED***;


internals.safeCharCodes = (function () ***REMOVED***

    const safe = ***REMOVED******REMOVED***;

    for (let i = 32; i < 123; ++i) ***REMOVED***

        if ((i >= 97) ||                    // a-z
            (i >= 65 && i <= 90) ||         // A-Z
            (i >= 48 && i <= 57) ||         // 0-9
            i === 32 ||                     // space
            i === 46 ||                     // .
            i === 44 ||                     // ,
            i === 45 ||                     // -
            i === 58 ||                     // :
            i === 95) ***REMOVED***                     // _

            safe[i] = null;
        ***REMOVED***
    ***REMOVED***

    return safe;
***REMOVED***());
