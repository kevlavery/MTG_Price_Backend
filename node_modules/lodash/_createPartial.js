var apply = require('./_apply'),
    createCtor = require('./_createCtor'),
    root = require('./_root');

/** Used to compose bitmasks for function metadata. */
var WRAP_BIND_FLAG = 1;

/**
 * Creates a function that wraps `func` to invoke it with the `this` binding
 * of `thisArg` and `partials` prepended to the arguments it receives.
 *
 * @private
 * @param ***REMOVED***Function***REMOVED*** func The function to wrap.
 * @param ***REMOVED***number***REMOVED*** bitmask The bitmask flags. See `createWrap` for more details.
 * @param ***REMOVED*******REMOVED*** thisArg The `this` binding of `func`.
 * @param ***REMOVED***Array***REMOVED*** partials The arguments to prepend to those provided to
 *  the new function.
 * @returns ***REMOVED***Function***REMOVED*** Returns the new wrapped function.
 */
function createPartial(func, bitmask, thisArg, partials) ***REMOVED***
  var isBind = bitmask & WRAP_BIND_FLAG,
      Ctor = createCtor(func);

  function wrapper() ***REMOVED***
    var argsIndex = -1,
        argsLength = arguments.length,
        leftIndex = -1,
        leftLength = partials.length,
        args = Array(leftLength + argsLength),
        fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;

    while (++leftIndex < leftLength) ***REMOVED***
      args[leftIndex] = partials[leftIndex];
    ***REMOVED***
    while (argsLength--) ***REMOVED***
      args[leftIndex++] = arguments[++argsIndex];
    ***REMOVED***
    return apply(fn, isBind ? thisArg : this, args);
  ***REMOVED***
  return wrapper;
***REMOVED***

module.exports = createPartial;
