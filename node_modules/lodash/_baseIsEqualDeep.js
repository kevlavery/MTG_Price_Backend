var Stack = require('./_Stack'),
    equalArrays = require('./_equalArrays'),
    equalByTag = require('./_equalByTag'),
    equalObjects = require('./_equalObjects'),
    getTag = require('./_getTag'),
    isArray = require('./isArray'),
    isBuffer = require('./isBuffer'),
    isTypedArray = require('./isTypedArray');

/** Used to compose bitmasks for value comparisons. */
var COMPARE_PARTIAL_FLAG = 1;

/** `Object#toString` result references. */
var argsTag = '[object Arguments]',
    arrayTag = '[object Array]',
    objectTag = '[object Object]';

/** Used for built-in method references. */
var objectProto = Object.prototype;

/** Used to check objects for own properties. */
var hasOwnProperty = objectProto.hasOwnProperty;

/**
 * A specialized version of `baseIsEqual` for arrays and objects which performs
 * deep comparisons and tracks traversed objects enabling objects with circular
 * references to be compared.
 *
 * @private
 * @param ***REMOVED***Object***REMOVED*** object The object to compare.
 * @param ***REMOVED***Object***REMOVED*** other The other object to compare.
 * @param ***REMOVED***number***REMOVED*** bitmask The bitmask flags. See `baseIsEqual` for more details.
 * @param ***REMOVED***Function***REMOVED*** customizer The function to customize comparisons.
 * @param ***REMOVED***Function***REMOVED*** equalFunc The function to determine equivalents of values.
 * @param ***REMOVED***Object***REMOVED*** [stack] Tracks traversed `object` and `other` objects.
 * @returns ***REMOVED***boolean***REMOVED*** Returns `true` if the objects are equivalent, else `false`.
 */
function baseIsEqualDeep(object, other, bitmask, customizer, equalFunc, stack) ***REMOVED***
  var objIsArr = isArray(object),
      othIsArr = isArray(other),
      objTag = objIsArr ? arrayTag : getTag(object),
      othTag = othIsArr ? arrayTag : getTag(other);

  objTag = objTag == argsTag ? objectTag : objTag;
  othTag = othTag == argsTag ? objectTag : othTag;

  var objIsObj = objTag == objectTag,
      othIsObj = othTag == objectTag,
      isSameTag = objTag == othTag;

  if (isSameTag && isBuffer(object)) ***REMOVED***
    if (!isBuffer(other)) ***REMOVED***
      return false;
    ***REMOVED***
    objIsArr = true;
    objIsObj = false;
  ***REMOVED***
  if (isSameTag && !objIsObj) ***REMOVED***
    stack || (stack = new Stack);
    return (objIsArr || isTypedArray(object))
      ? equalArrays(object, other, bitmask, customizer, equalFunc, stack)
      : equalByTag(object, other, objTag, bitmask, customizer, equalFunc, stack);
  ***REMOVED***
  if (!(bitmask & COMPARE_PARTIAL_FLAG)) ***REMOVED***
    var objIsWrapped = objIsObj && hasOwnProperty.call(object, '__wrapped__'),
        othIsWrapped = othIsObj && hasOwnProperty.call(other, '__wrapped__');

    if (objIsWrapped || othIsWrapped) ***REMOVED***
      var objUnwrapped = objIsWrapped ? object.value() : object,
          othUnwrapped = othIsWrapped ? other.value() : other;

      stack || (stack = new Stack);
      return equalFunc(objUnwrapped, othUnwrapped, bitmask, customizer, stack);
    ***REMOVED***
  ***REMOVED***
  if (!isSameTag) ***REMOVED***
    return false;
  ***REMOVED***
  stack || (stack = new Stack);
  return equalObjects(object, other, bitmask, customizer, equalFunc, stack);
***REMOVED***

module.exports = baseIsEqualDeep;
