var apply = require('./_apply'),
    createCtor = require('./_createCtor'),
    createHybrid = require('./_createHybrid'),
    createRecurry = require('./_createRecurry'),
    getHolder = require('./_getHolder'),
    replaceHolders = require('./_replaceHolders'),
    root = require('./_root');

/**
 * Creates a function that wraps `func` to enable currying.
 *
 * @private
 * @param ***REMOVED***Function***REMOVED*** func The function to wrap.
 * @param ***REMOVED***number***REMOVED*** bitmask The bitmask flags. See `createWrap` for more details.
 * @param ***REMOVED***number***REMOVED*** arity The arity of `func`.
 * @returns ***REMOVED***Function***REMOVED*** Returns the new wrapped function.
 */
function createCurry(func, bitmask, arity) ***REMOVED***
  var Ctor = createCtor(func);

  function wrapper() ***REMOVED***
    var length = arguments.length,
        args = Array(length),
        index = length,
        placeholder = getHolder(wrapper);

    while (index--) ***REMOVED***
      args[index] = arguments[index];
    ***REMOVED***
    var holders = (length < 3 && args[0] !== placeholder && args[length - 1] !== placeholder)
      ? []
      : replaceHolders(args, placeholder);

    length -= holders.length;
    if (length < arity) ***REMOVED***
      return createRecurry(
        func, bitmask, createHybrid, wrapper.placeholder, undefined,
        args, holders, undefined, undefined, arity - length);
    ***REMOVED***
    var fn = (this && this !== root && this instanceof wrapper) ? Ctor : func;
    return apply(fn, this, args);
  ***REMOVED***
  return wrapper;
***REMOVED***

module.exports = createCurry;
