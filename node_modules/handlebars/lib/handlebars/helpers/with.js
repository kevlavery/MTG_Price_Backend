import ***REMOVED***appendContextPath, blockParams, createFrame, isEmpty, isFunction***REMOVED*** from '../utils';

export default function(instance) ***REMOVED***
  instance.registerHelper('with', function(context, options) ***REMOVED***
    if (isFunction(context)) ***REMOVED*** context = context.call(this); ***REMOVED***

    let fn = options.fn;

    if (!isEmpty(context)) ***REMOVED***
      let data = options.data;
      if (options.data && options.ids) ***REMOVED***
        data = createFrame(options.data);
        data.contextPath = appendContextPath(options.data.contextPath, options.ids[0]);
      ***REMOVED***

      return fn(context, ***REMOVED***
        data: data,
        blockParams: blockParams([context], [data && data.contextPath])
      ***REMOVED***);
    ***REMOVED*** else ***REMOVED***
      return options.inverse(this);
    ***REMOVED***
  ***REMOVED***);
***REMOVED***
