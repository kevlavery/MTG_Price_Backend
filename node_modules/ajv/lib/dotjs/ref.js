'use strict';
module.exports = function generate_ref(it, $keyword, $ruleType) ***REMOVED***
  var out = ' ';
  var $lvl = it.level;
  var $dataLvl = it.dataLevel;
  var $schema = it.schema[$keyword];
  var $errSchemaPath = it.errSchemaPath + '/' + $keyword;
  var $breakOnError = !it.opts.allErrors;
  var $data = 'data' + ($dataLvl || '');
  var $valid = 'valid' + $lvl;
  var $async, $refCode;
  if ($schema == '#' || $schema == '#/') ***REMOVED***
    if (it.isRoot) ***REMOVED***
      $async = it.async;
      $refCode = 'validate';
    ***REMOVED*** else ***REMOVED***
      $async = it.root.schema.$async === true;
      $refCode = 'root.refVal[0]';
    ***REMOVED***
  ***REMOVED*** else ***REMOVED***
    var $refVal = it.resolveRef(it.baseId, $schema, it.isRoot);
    if ($refVal === undefined) ***REMOVED***
      var $message = it.MissingRefError.message(it.baseId, $schema);
      if (it.opts.missingRefs == 'fail') ***REMOVED***
        it.logger.error($message);
        var $$outStack = $$outStack || [];
        $$outStack.push(out);
        out = ''; /* istanbul ignore else */
        if (it.createErrors !== false) ***REMOVED***
          out += ' ***REMOVED*** keyword: \'' + ('$ref') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED*** ref: \'' + (it.util.escapeQuotes($schema)) + '\' ***REMOVED*** ';
          if (it.opts.messages !== false) ***REMOVED***
            out += ' , message: \'can\\\'t resolve reference ' + (it.util.escapeQuotes($schema)) + '\' ';
          ***REMOVED***
          if (it.opts.verbose) ***REMOVED***
            out += ' , schema: ' + (it.util.toQuotedString($schema)) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
          ***REMOVED***
          out += ' ***REMOVED*** ';
        ***REMOVED*** else ***REMOVED***
          out += ' ***REMOVED******REMOVED*** ';
        ***REMOVED***
        var __err = out;
        out = $$outStack.pop();
        if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
          if (it.async) ***REMOVED***
            out += ' throw new ValidationError([' + (__err) + ']); ';
          ***REMOVED*** else ***REMOVED***
            out += ' validate.errors = [' + (__err) + ']; return false; ';
          ***REMOVED***
        ***REMOVED*** else ***REMOVED***
          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
        ***REMOVED***
        if ($breakOnError) ***REMOVED***
          out += ' if (false) ***REMOVED*** ';
        ***REMOVED***
      ***REMOVED*** else if (it.opts.missingRefs == 'ignore') ***REMOVED***
        it.logger.warn($message);
        if ($breakOnError) ***REMOVED***
          out += ' if (true) ***REMOVED*** ';
        ***REMOVED***
      ***REMOVED*** else ***REMOVED***
        throw new it.MissingRefError(it.baseId, $schema, $message);
      ***REMOVED***
    ***REMOVED*** else if ($refVal.inline) ***REMOVED***
      var $it = it.util.copy(it);
      $it.level++;
      var $nextValid = 'valid' + $it.level;
      $it.schema = $refVal.schema;
      $it.schemaPath = '';
      $it.errSchemaPath = $schema;
      var $code = it.validate($it).replace(/validate\.schema/g, $refVal.code);
      out += ' ' + ($code) + ' ';
      if ($breakOnError) ***REMOVED***
        out += ' if (' + ($nextValid) + ') ***REMOVED*** ';
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      $async = $refVal.$async === true;
      $refCode = $refVal.code;
    ***REMOVED***
  ***REMOVED***
  if ($refCode) ***REMOVED***
    var $$outStack = $$outStack || [];
    $$outStack.push(out);
    out = '';
    if (it.opts.passContext) ***REMOVED***
      out += ' ' + ($refCode) + '.call(this, ';
    ***REMOVED*** else ***REMOVED***
      out += ' ' + ($refCode) + '( ';
    ***REMOVED***
    out += ' ' + ($data) + ', (dataPath || \'\')';
    if (it.errorPath != '""') ***REMOVED***
      out += ' + ' + (it.errorPath);
    ***REMOVED***
    var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',
      $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';
    out += ' , ' + ($parentData) + ' , ' + ($parentDataProperty) + ', rootData)  ';
    var __callValidate = out;
    out = $$outStack.pop();
    if ($async) ***REMOVED***
      if (!it.async) throw new Error('async schema referenced by sync schema');
      if ($breakOnError) ***REMOVED***
        out += ' var ' + ($valid) + '; ';
      ***REMOVED***
      out += ' try ***REMOVED*** ' + (it.yieldAwait) + ' ' + (__callValidate) + '; ';
      if ($breakOnError) ***REMOVED***
        out += ' ' + ($valid) + ' = true; ';
      ***REMOVED***
      out += ' ***REMOVED*** catch (e) ***REMOVED*** if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ';
      if ($breakOnError) ***REMOVED***
        out += ' ' + ($valid) + ' = false; ';
      ***REMOVED***
      out += ' ***REMOVED*** ';
      if ($breakOnError) ***REMOVED***
        out += ' if (' + ($valid) + ') ***REMOVED*** ';
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      out += ' if (!' + (__callValidate) + ') ***REMOVED*** if (vErrors === null) vErrors = ' + ($refCode) + '.errors; else vErrors = vErrors.concat(' + ($refCode) + '.errors); errors = vErrors.length; ***REMOVED*** ';
      if ($breakOnError) ***REMOVED***
        out += ' else ***REMOVED*** ';
      ***REMOVED***
    ***REMOVED***
  ***REMOVED***
  return out;
***REMOVED***
