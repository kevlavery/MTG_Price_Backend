'use strict';
module.exports = function generate_validate(it, $keyword, $ruleType) ***REMOVED***
  var out = '';
  var $async = it.schema.$async === true,
    $refKeywords = it.util.schemaHasRulesExcept(it.schema, it.RULES.all, '$ref'),
    $id = it.self._getId(it.schema);
  if (it.isTop) ***REMOVED***
    if ($async) ***REMOVED***
      it.async = true;
      var $es7 = it.opts.async == 'es7';
      it.yieldAwait = $es7 ? 'await' : 'yield';
    ***REMOVED***
    out += ' var validate = ';
    if ($async) ***REMOVED***
      if ($es7) ***REMOVED***
        out += ' (async function ';
      ***REMOVED*** else ***REMOVED***
        if (it.opts.async != '*') ***REMOVED***
          out += 'co.wrap';
        ***REMOVED***
        out += '(function* ';
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      out += ' (function ';
    ***REMOVED***
    out += ' (data, dataPath, parentData, parentDataProperty, rootData) ***REMOVED*** \'use strict\'; ';
    if ($id && (it.opts.sourceCode || it.opts.processCode)) ***REMOVED***
      out += ' ' + ('/\*# sourceURL=' + $id + ' */') + ' ';
    ***REMOVED***
  ***REMOVED***
  if (typeof it.schema == 'boolean' || !($refKeywords || it.schema.$ref)) ***REMOVED***
    var $keyword = 'false schema';
    var $lvl = it.level;
    var $dataLvl = it.dataLevel;
    var $schema = it.schema[$keyword];
    var $schemaPath = it.schemaPath + it.util.getProperty($keyword);
    var $errSchemaPath = it.errSchemaPath + '/' + $keyword;
    var $breakOnError = !it.opts.allErrors;
    var $errorKeyword;
    var $data = 'data' + ($dataLvl || '');
    var $valid = 'valid' + $lvl;
    if (it.schema === false) ***REMOVED***
      if (it.isTop) ***REMOVED***
        $breakOnError = true;
      ***REMOVED*** else ***REMOVED***
        out += ' var ' + ($valid) + ' = false; ';
      ***REMOVED***
      var $$outStack = $$outStack || [];
      $$outStack.push(out);
      out = ''; /* istanbul ignore else */
      if (it.createErrors !== false) ***REMOVED***
        out += ' ***REMOVED*** keyword: \'' + ($errorKeyword || 'false schema') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED******REMOVED*** ';
        if (it.opts.messages !== false) ***REMOVED***
          out += ' , message: \'boolean schema is false\' ';
        ***REMOVED***
        if (it.opts.verbose) ***REMOVED***
          out += ' , schema: false , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
        ***REMOVED***
        out += ' ***REMOVED*** ';
      ***REMOVED*** else ***REMOVED***
        out += ' ***REMOVED******REMOVED*** ';
      ***REMOVED***
      var __err = out;
      out = $$outStack.pop();
      if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
        if (it.async) ***REMOVED***
          out += ' throw new ValidationError([' + (__err) + ']); ';
        ***REMOVED*** else ***REMOVED***
          out += ' validate.errors = [' + (__err) + ']; return false; ';
        ***REMOVED***
      ***REMOVED*** else ***REMOVED***
        out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
      ***REMOVED***
    ***REMOVED*** else ***REMOVED***
      if (it.isTop) ***REMOVED***
        if ($async) ***REMOVED***
          out += ' return data; ';
        ***REMOVED*** else ***REMOVED***
          out += ' validate.errors = null; return true; ';
        ***REMOVED***
      ***REMOVED*** else ***REMOVED***
        out += ' var ' + ($valid) + ' = true; ';
      ***REMOVED***
    ***REMOVED***
    if (it.isTop) ***REMOVED***
      out += ' ***REMOVED***); return validate; ';
    ***REMOVED***
    return out;
  ***REMOVED***
  if (it.isTop) ***REMOVED***
    var $top = it.isTop,
      $lvl = it.level = 0,
      $dataLvl = it.dataLevel = 0,
      $data = 'data';
    it.rootId = it.resolve.fullPath(it.self._getId(it.root.schema));
    it.baseId = it.baseId || it.rootId;
    delete it.isTop;
    it.dataPathArr = [undefined];
    out += ' var vErrors = null; ';
    out += ' var errors = 0;     ';
    out += ' if (rootData === undefined) rootData = data; ';
  ***REMOVED*** else ***REMOVED***
    var $lvl = it.level,
      $dataLvl = it.dataLevel,
      $data = 'data' + ($dataLvl || '');
    if ($id) it.baseId = it.resolve.url(it.baseId, $id);
    if ($async && !it.async) throw new Error('async schema in sync schema');
    out += ' var errs_' + ($lvl) + ' = errors;';
  ***REMOVED***
  var $valid = 'valid' + $lvl,
    $breakOnError = !it.opts.allErrors,
    $closingBraces1 = '',
    $closingBraces2 = '';
  var $errorKeyword;
  var $typeSchema = it.schema.type,
    $typeIsArray = Array.isArray($typeSchema);
  if ($typeIsArray && $typeSchema.length == 1) ***REMOVED***
    $typeSchema = $typeSchema[0];
    $typeIsArray = false;
  ***REMOVED***
  if (it.schema.$ref && $refKeywords) ***REMOVED***
    if (it.opts.extendRefs == 'fail') ***REMOVED***
      throw new Error('$ref: validation keywords used in schema at path "' + it.errSchemaPath + '" (see option extendRefs)');
    ***REMOVED*** else if (it.opts.extendRefs !== true) ***REMOVED***
      $refKeywords = false;
      it.logger.warn('$ref: keywords ignored in schema at path "' + it.errSchemaPath + '"');
    ***REMOVED***
  ***REMOVED***
  if ($typeSchema) ***REMOVED***
    if (it.opts.coerceTypes) ***REMOVED***
      var $coerceToTypes = it.util.coerceToTypes(it.opts.coerceTypes, $typeSchema);
    ***REMOVED***
    var $rulesGroup = it.RULES.types[$typeSchema];
    if ($coerceToTypes || $typeIsArray || $rulesGroup === true || ($rulesGroup && !$shouldUseGroup($rulesGroup))) ***REMOVED***
      var $schemaPath = it.schemaPath + '.type',
        $errSchemaPath = it.errSchemaPath + '/type';
      var $schemaPath = it.schemaPath + '.type',
        $errSchemaPath = it.errSchemaPath + '/type',
        $method = $typeIsArray ? 'checkDataTypes' : 'checkDataType';
      out += ' if (' + (it.util[$method]($typeSchema, $data, true)) + ') ***REMOVED*** ';
      if ($coerceToTypes) ***REMOVED***
        var $dataType = 'dataType' + $lvl,
          $coerced = 'coerced' + $lvl;
        out += ' var ' + ($dataType) + ' = typeof ' + ($data) + '; ';
        if (it.opts.coerceTypes == 'array') ***REMOVED***
          out += ' if (' + ($dataType) + ' == \'object\' && Array.isArray(' + ($data) + ')) ' + ($dataType) + ' = \'array\'; ';
        ***REMOVED***
        out += ' var ' + ($coerced) + ' = undefined; ';
        var $bracesCoercion = '';
        var arr1 = $coerceToTypes;
        if (arr1) ***REMOVED***
          var $type, $i = -1,
            l1 = arr1.length - 1;
          while ($i < l1) ***REMOVED***
            $type = arr1[$i += 1];
            if ($i) ***REMOVED***
              out += ' if (' + ($coerced) + ' === undefined) ***REMOVED*** ';
              $bracesCoercion += '***REMOVED***';
            ***REMOVED***
            if (it.opts.coerceTypes == 'array' && $type != 'array') ***REMOVED***
              out += ' if (' + ($dataType) + ' == \'array\' && ' + ($data) + '.length == 1) ***REMOVED*** ' + ($coerced) + ' = ' + ($data) + ' = ' + ($data) + '[0]; ' + ($dataType) + ' = typeof ' + ($data) + ';  ***REMOVED*** ';
            ***REMOVED***
            if ($type == 'string') ***REMOVED***
              out += ' if (' + ($dataType) + ' == \'number\' || ' + ($dataType) + ' == \'boolean\') ' + ($coerced) + ' = \'\' + ' + ($data) + '; else if (' + ($data) + ' === null) ' + ($coerced) + ' = \'\'; ';
            ***REMOVED*** else if ($type == 'number' || $type == 'integer') ***REMOVED***
              out += ' if (' + ($dataType) + ' == \'boolean\' || ' + ($data) + ' === null || (' + ($dataType) + ' == \'string\' && ' + ($data) + ' && ' + ($data) + ' == +' + ($data) + ' ';
              if ($type == 'integer') ***REMOVED***
                out += ' && !(' + ($data) + ' % 1)';
              ***REMOVED***
              out += ')) ' + ($coerced) + ' = +' + ($data) + '; ';
            ***REMOVED*** else if ($type == 'boolean') ***REMOVED***
              out += ' if (' + ($data) + ' === \'false\' || ' + ($data) + ' === 0 || ' + ($data) + ' === null) ' + ($coerced) + ' = false; else if (' + ($data) + ' === \'true\' || ' + ($data) + ' === 1) ' + ($coerced) + ' = true; ';
            ***REMOVED*** else if ($type == 'null') ***REMOVED***
              out += ' if (' + ($data) + ' === \'\' || ' + ($data) + ' === 0 || ' + ($data) + ' === false) ' + ($coerced) + ' = null; ';
            ***REMOVED*** else if (it.opts.coerceTypes == 'array' && $type == 'array') ***REMOVED***
              out += ' if (' + ($dataType) + ' == \'string\' || ' + ($dataType) + ' == \'number\' || ' + ($dataType) + ' == \'boolean\' || ' + ($data) + ' == null) ' + ($coerced) + ' = [' + ($data) + ']; ';
            ***REMOVED***
          ***REMOVED***
        ***REMOVED***
        out += ' ' + ($bracesCoercion) + ' if (' + ($coerced) + ' === undefined) ***REMOVED***   ';
        var $$outStack = $$outStack || [];
        $$outStack.push(out);
        out = ''; /* istanbul ignore else */
        if (it.createErrors !== false) ***REMOVED***
          out += ' ***REMOVED*** keyword: \'' + ($errorKeyword || 'type') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED*** type: \'';
          if ($typeIsArray) ***REMOVED***
            out += '' + ($typeSchema.join(","));
          ***REMOVED*** else ***REMOVED***
            out += '' + ($typeSchema);
          ***REMOVED***
          out += '\' ***REMOVED*** ';
          if (it.opts.messages !== false) ***REMOVED***
            out += ' , message: \'should be ';
            if ($typeIsArray) ***REMOVED***
              out += '' + ($typeSchema.join(","));
            ***REMOVED*** else ***REMOVED***
              out += '' + ($typeSchema);
            ***REMOVED***
            out += '\' ';
          ***REMOVED***
          if (it.opts.verbose) ***REMOVED***
            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
          ***REMOVED***
          out += ' ***REMOVED*** ';
        ***REMOVED*** else ***REMOVED***
          out += ' ***REMOVED******REMOVED*** ';
        ***REMOVED***
        var __err = out;
        out = $$outStack.pop();
        if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
          if (it.async) ***REMOVED***
            out += ' throw new ValidationError([' + (__err) + ']); ';
          ***REMOVED*** else ***REMOVED***
            out += ' validate.errors = [' + (__err) + ']; return false; ';
          ***REMOVED***
        ***REMOVED*** else ***REMOVED***
          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
        ***REMOVED***
        out += ' ***REMOVED*** else ***REMOVED***  ';
        var $parentData = $dataLvl ? 'data' + (($dataLvl - 1) || '') : 'parentData',
          $parentDataProperty = $dataLvl ? it.dataPathArr[$dataLvl] : 'parentDataProperty';
        out += ' ' + ($data) + ' = ' + ($coerced) + '; ';
        if (!$dataLvl) ***REMOVED***
          out += 'if (' + ($parentData) + ' !== undefined)';
        ***REMOVED***
        out += ' ' + ($parentData) + '[' + ($parentDataProperty) + '] = ' + ($coerced) + '; ***REMOVED*** ';
      ***REMOVED*** else ***REMOVED***
        var $$outStack = $$outStack || [];
        $$outStack.push(out);
        out = ''; /* istanbul ignore else */
        if (it.createErrors !== false) ***REMOVED***
          out += ' ***REMOVED*** keyword: \'' + ($errorKeyword || 'type') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED*** type: \'';
          if ($typeIsArray) ***REMOVED***
            out += '' + ($typeSchema.join(","));
          ***REMOVED*** else ***REMOVED***
            out += '' + ($typeSchema);
          ***REMOVED***
          out += '\' ***REMOVED*** ';
          if (it.opts.messages !== false) ***REMOVED***
            out += ' , message: \'should be ';
            if ($typeIsArray) ***REMOVED***
              out += '' + ($typeSchema.join(","));
            ***REMOVED*** else ***REMOVED***
              out += '' + ($typeSchema);
            ***REMOVED***
            out += '\' ';
          ***REMOVED***
          if (it.opts.verbose) ***REMOVED***
            out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
          ***REMOVED***
          out += ' ***REMOVED*** ';
        ***REMOVED*** else ***REMOVED***
          out += ' ***REMOVED******REMOVED*** ';
        ***REMOVED***
        var __err = out;
        out = $$outStack.pop();
        if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
          if (it.async) ***REMOVED***
            out += ' throw new ValidationError([' + (__err) + ']); ';
          ***REMOVED*** else ***REMOVED***
            out += ' validate.errors = [' + (__err) + ']; return false; ';
          ***REMOVED***
        ***REMOVED*** else ***REMOVED***
          out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
        ***REMOVED***
      ***REMOVED***
      out += ' ***REMOVED*** ';
    ***REMOVED***
  ***REMOVED***
  if (it.schema.$ref && !$refKeywords) ***REMOVED***
    out += ' ' + (it.RULES.all.$ref.code(it, '$ref')) + ' ';
    if ($breakOnError) ***REMOVED***
      out += ' ***REMOVED*** if (errors === ';
      if ($top) ***REMOVED***
        out += '0';
      ***REMOVED*** else ***REMOVED***
        out += 'errs_' + ($lvl);
      ***REMOVED***
      out += ') ***REMOVED*** ';
      $closingBraces2 += '***REMOVED***';
    ***REMOVED***
  ***REMOVED*** else ***REMOVED***
    if (it.opts.v5 && it.schema.patternGroups) ***REMOVED***
      it.logger.warn('keyword "patternGroups" is deprecated and disabled. Use option patternGroups: true to enable.');
    ***REMOVED***
    var arr2 = it.RULES;
    if (arr2) ***REMOVED***
      var $rulesGroup, i2 = -1,
        l2 = arr2.length - 1;
      while (i2 < l2) ***REMOVED***
        $rulesGroup = arr2[i2 += 1];
        if ($shouldUseGroup($rulesGroup)) ***REMOVED***
          if ($rulesGroup.type) ***REMOVED***
            out += ' if (' + (it.util.checkDataType($rulesGroup.type, $data)) + ') ***REMOVED*** ';
          ***REMOVED***
          if (it.opts.useDefaults && !it.compositeRule) ***REMOVED***
            if ($rulesGroup.type == 'object' && it.schema.properties) ***REMOVED***
              var $schema = it.schema.properties,
                $schemaKeys = Object.keys($schema);
              var arr3 = $schemaKeys;
              if (arr3) ***REMOVED***
                var $propertyKey, i3 = -1,
                  l3 = arr3.length - 1;
                while (i3 < l3) ***REMOVED***
                  $propertyKey = arr3[i3 += 1];
                  var $sch = $schema[$propertyKey];
                  if ($sch.default !== undefined) ***REMOVED***
                    var $passData = $data + it.util.getProperty($propertyKey);
                    out += '  if (' + ($passData) + ' === undefined) ' + ($passData) + ' = ';
                    if (it.opts.useDefaults == 'shared') ***REMOVED***
                      out += ' ' + (it.useDefault($sch.default)) + ' ';
                    ***REMOVED*** else ***REMOVED***
                      out += ' ' + (JSON.stringify($sch.default)) + ' ';
                    ***REMOVED***
                    out += '; ';
                  ***REMOVED***
                ***REMOVED***
              ***REMOVED***
            ***REMOVED*** else if ($rulesGroup.type == 'array' && Array.isArray(it.schema.items)) ***REMOVED***
              var arr4 = it.schema.items;
              if (arr4) ***REMOVED***
                var $sch, $i = -1,
                  l4 = arr4.length - 1;
                while ($i < l4) ***REMOVED***
                  $sch = arr4[$i += 1];
                  if ($sch.default !== undefined) ***REMOVED***
                    var $passData = $data + '[' + $i + ']';
                    out += '  if (' + ($passData) + ' === undefined) ' + ($passData) + ' = ';
                    if (it.opts.useDefaults == 'shared') ***REMOVED***
                      out += ' ' + (it.useDefault($sch.default)) + ' ';
                    ***REMOVED*** else ***REMOVED***
                      out += ' ' + (JSON.stringify($sch.default)) + ' ';
                    ***REMOVED***
                    out += '; ';
                  ***REMOVED***
                ***REMOVED***
              ***REMOVED***
            ***REMOVED***
          ***REMOVED***
          var arr5 = $rulesGroup.rules;
          if (arr5) ***REMOVED***
            var $rule, i5 = -1,
              l5 = arr5.length - 1;
            while (i5 < l5) ***REMOVED***
              $rule = arr5[i5 += 1];
              if ($shouldUseRule($rule)) ***REMOVED***
                var $code = $rule.code(it, $rule.keyword, $rulesGroup.type);
                if ($code) ***REMOVED***
                  out += ' ' + ($code) + ' ';
                  if ($breakOnError) ***REMOVED***
                    $closingBraces1 += '***REMOVED***';
                  ***REMOVED***
                ***REMOVED***
              ***REMOVED***
            ***REMOVED***
          ***REMOVED***
          if ($breakOnError) ***REMOVED***
            out += ' ' + ($closingBraces1) + ' ';
            $closingBraces1 = '';
          ***REMOVED***
          if ($rulesGroup.type) ***REMOVED***
            out += ' ***REMOVED*** ';
            if ($typeSchema && $typeSchema === $rulesGroup.type && !$coerceToTypes) ***REMOVED***
              out += ' else ***REMOVED*** ';
              var $schemaPath = it.schemaPath + '.type',
                $errSchemaPath = it.errSchemaPath + '/type';
              var $$outStack = $$outStack || [];
              $$outStack.push(out);
              out = ''; /* istanbul ignore else */
              if (it.createErrors !== false) ***REMOVED***
                out += ' ***REMOVED*** keyword: \'' + ($errorKeyword || 'type') + '\' , dataPath: (dataPath || \'\') + ' + (it.errorPath) + ' , schemaPath: ' + (it.util.toQuotedString($errSchemaPath)) + ' , params: ***REMOVED*** type: \'';
                if ($typeIsArray) ***REMOVED***
                  out += '' + ($typeSchema.join(","));
                ***REMOVED*** else ***REMOVED***
                  out += '' + ($typeSchema);
                ***REMOVED***
                out += '\' ***REMOVED*** ';
                if (it.opts.messages !== false) ***REMOVED***
                  out += ' , message: \'should be ';
                  if ($typeIsArray) ***REMOVED***
                    out += '' + ($typeSchema.join(","));
                  ***REMOVED*** else ***REMOVED***
                    out += '' + ($typeSchema);
                  ***REMOVED***
                  out += '\' ';
                ***REMOVED***
                if (it.opts.verbose) ***REMOVED***
                  out += ' , schema: validate.schema' + ($schemaPath) + ' , parentSchema: validate.schema' + (it.schemaPath) + ' , data: ' + ($data) + ' ';
                ***REMOVED***
                out += ' ***REMOVED*** ';
              ***REMOVED*** else ***REMOVED***
                out += ' ***REMOVED******REMOVED*** ';
              ***REMOVED***
              var __err = out;
              out = $$outStack.pop();
              if (!it.compositeRule && $breakOnError) ***REMOVED*** /* istanbul ignore if */
                if (it.async) ***REMOVED***
                  out += ' throw new ValidationError([' + (__err) + ']); ';
                ***REMOVED*** else ***REMOVED***
                  out += ' validate.errors = [' + (__err) + ']; return false; ';
                ***REMOVED***
              ***REMOVED*** else ***REMOVED***
                out += ' var err = ' + (__err) + ';  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ';
              ***REMOVED***
              out += ' ***REMOVED*** ';
            ***REMOVED***
          ***REMOVED***
          if ($breakOnError) ***REMOVED***
            out += ' if (errors === ';
            if ($top) ***REMOVED***
              out += '0';
            ***REMOVED*** else ***REMOVED***
              out += 'errs_' + ($lvl);
            ***REMOVED***
            out += ') ***REMOVED*** ';
            $closingBraces2 += '***REMOVED***';
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***
    ***REMOVED***
  ***REMOVED***
  if ($breakOnError) ***REMOVED***
    out += ' ' + ($closingBraces2) + ' ';
  ***REMOVED***
  if ($top) ***REMOVED***
    if ($async) ***REMOVED***
      out += ' if (errors === 0) return data;           ';
      out += ' else throw new ValidationError(vErrors); ';
    ***REMOVED*** else ***REMOVED***
      out += ' validate.errors = vErrors; ';
      out += ' return errors === 0;       ';
    ***REMOVED***
    out += ' ***REMOVED***); return validate;';
  ***REMOVED*** else ***REMOVED***
    out += ' var ' + ($valid) + ' = errors === errs_' + ($lvl) + ';';
  ***REMOVED***
  out = it.util.cleanUpCode(out);
  if ($top) ***REMOVED***
    out = it.util.finalCleanUpCode(out, $async);
  ***REMOVED***

  function $shouldUseGroup($rulesGroup) ***REMOVED***
    var rules = $rulesGroup.rules;
    for (var i = 0; i < rules.length; i++)
      if ($shouldUseRule(rules[i])) return true;
  ***REMOVED***

  function $shouldUseRule($rule) ***REMOVED***
    return it.schema[$rule.keyword] !== undefined || ($rule.implements && $ruleImplementsSomeKeyword($rule));
  ***REMOVED***

  function $ruleImplementsSomeKeyword($rule) ***REMOVED***
    var impl = $rule.implements;
    for (var i = 0; i < impl.length; i++)
      if (it.schema[impl[i]] !== undefined) return true;
  ***REMOVED***
  return out;
***REMOVED***
