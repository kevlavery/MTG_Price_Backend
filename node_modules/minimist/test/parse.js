var parse = require('../');
var test = require('tape');

test('parse args', function (t) ***REMOVED***
    t.deepEqual(
        parse([ '--no-moo' ]),
        ***REMOVED*** moo : false, _ : [] ***REMOVED***,
        'no'
    );
    t.deepEqual(
        parse([ '-v', 'a', '-v', 'b', '-v', 'c' ]),
        ***REMOVED*** v : ['a','b','c'], _ : [] ***REMOVED***,
        'multi'
    );
    t.end();
***REMOVED***);
 
test('comprehensive', function (t) ***REMOVED***
    t.deepEqual(
        parse([
            '--name=meowmers', 'bare', '-cats', 'woo',
            '-h', 'awesome', '--multi=quux',
            '--key', 'value',
            '-b', '--bool', '--no-meep', '--multi=baz',
            '--', '--not-a-flag', 'eek'
        ]),
        ***REMOVED***
            c : true,
            a : true,
            t : true,
            s : 'woo',
            h : 'awesome',
            b : true,
            bool : true,
            key : 'value',
            multi : [ 'quux', 'baz' ],
            meep : false,
            name : 'meowmers',
            _ : [ 'bare', '--not-a-flag', 'eek' ]
        ***REMOVED***
    );
    t.end();
***REMOVED***);

test('flag boolean', function (t) ***REMOVED***
    var argv = parse([ '-t', 'moo' ], ***REMOVED*** boolean: 't' ***REMOVED***);
    t.deepEqual(argv, ***REMOVED*** t : true, _ : [ 'moo' ] ***REMOVED***);
    t.deepEqual(typeof argv.t, 'boolean');
    t.end();
***REMOVED***);

test('flag boolean value', function (t) ***REMOVED***
    var argv = parse(['--verbose', 'false', 'moo', '-t', 'true'], ***REMOVED***
        boolean: [ 't', 'verbose' ],
        default: ***REMOVED*** verbose: true ***REMOVED***
    ***REMOVED***);
    
    t.deepEqual(argv, ***REMOVED***
        verbose: false,
        t: true,
        _: ['moo']
    ***REMOVED***);
    
    t.deepEqual(typeof argv.verbose, 'boolean');
    t.deepEqual(typeof argv.t, 'boolean');
    t.end();
***REMOVED***);

test('newlines in params' , function (t) ***REMOVED***
    var args = parse([ '-s', "X\nX" ])
    t.deepEqual(args, ***REMOVED*** _ : [], s : "X\nX" ***REMOVED***);
    
    // reproduce in bash:
    // VALUE="new
    // line"
    // node program.js --s="$VALUE"
    args = parse([ "--s=X\nX" ])
    t.deepEqual(args, ***REMOVED*** _ : [], s : "X\nX" ***REMOVED***);
    t.end();
***REMOVED***);

test('strings' , function (t) ***REMOVED***
    var s = parse([ '-s', '0001234' ], ***REMOVED*** string: 's' ***REMOVED***).s;
    t.equal(s, '0001234');
    t.equal(typeof s, 'string');
    
    var x = parse([ '-x', '56' ], ***REMOVED*** string: 'x' ***REMOVED***).x;
    t.equal(x, '56');
    t.equal(typeof x, 'string');
    t.end();
***REMOVED***);

test('stringArgs', function (t) ***REMOVED***
    var s = parse([ '  ', '  ' ], ***REMOVED*** string: '_' ***REMOVED***)._;
    t.same(s.length, 2);
    t.same(typeof s[0], 'string');
    t.same(s[0], '  ');
    t.same(typeof s[1], 'string');
    t.same(s[1], '  ');
    t.end();
***REMOVED***);

test('empty strings', function(t) ***REMOVED***
    var s = parse([ '-s' ], ***REMOVED*** string: 's' ***REMOVED***).s;
    t.equal(s, '');
    t.equal(typeof s, 'string');

    var str = parse([ '--str' ], ***REMOVED*** string: 'str' ***REMOVED***).str;
    t.equal(str, '');
    t.equal(typeof str, 'string');

    var letters = parse([ '-art' ], ***REMOVED***
        string: [ 'a', 't' ]
    ***REMOVED***);

    t.equal(letters.a, '');
    t.equal(letters.r, true);
    t.equal(letters.t, '');

    t.end();
***REMOVED***);


test('string and alias', function(t) ***REMOVED***
    var x = parse([ '--str',  '000123' ], ***REMOVED***
        string: 's',
        alias: ***REMOVED*** s: 'str' ***REMOVED***
    ***REMOVED***);

    t.equal(x.str, '000123');
    t.equal(typeof x.str, 'string');
    t.equal(x.s, '000123');
    t.equal(typeof x.s, 'string');

    var y = parse([ '-s',  '000123' ], ***REMOVED***
        string: 'str',
        alias: ***REMOVED*** str: 's' ***REMOVED***
    ***REMOVED***);

    t.equal(y.str, '000123');
    t.equal(typeof y.str, 'string');
    t.equal(y.s, '000123');
    t.equal(typeof y.s, 'string');
    t.end();
***REMOVED***);

test('slashBreak', function (t) ***REMOVED***
    t.same(
        parse([ '-I/foo/bar/baz' ]),
        ***REMOVED*** I : '/foo/bar/baz', _ : [] ***REMOVED***
    );
    t.same(
        parse([ '-xyz/foo/bar/baz' ]),
        ***REMOVED*** x : true, y : true, z : '/foo/bar/baz', _ : [] ***REMOVED***
    );
    t.end();
***REMOVED***);

test('alias', function (t) ***REMOVED***
    var argv = parse([ '-f', '11', '--zoom', '55' ], ***REMOVED***
        alias: ***REMOVED*** z: 'zoom' ***REMOVED***
    ***REMOVED***);
    t.equal(argv.zoom, 55);
    t.equal(argv.z, argv.zoom);
    t.equal(argv.f, 11);
    t.end();
***REMOVED***);

test('multiAlias', function (t) ***REMOVED***
    var argv = parse([ '-f', '11', '--zoom', '55' ], ***REMOVED***
        alias: ***REMOVED*** z: [ 'zm', 'zoom' ] ***REMOVED***
    ***REMOVED***);
    t.equal(argv.zoom, 55);
    t.equal(argv.z, argv.zoom);
    t.equal(argv.z, argv.zm);
    t.equal(argv.f, 11);
    t.end();
***REMOVED***);

test('nested dotted objects', function (t) ***REMOVED***
    var argv = parse([
        '--foo.bar', '3', '--foo.baz', '4',
        '--foo.quux.quibble', '5', '--foo.quux.o_O',
        '--beep.boop'
    ]);
    
    t.same(argv.foo, ***REMOVED***
        bar : 3,
        baz : 4,
        quux : ***REMOVED***
            quibble : 5,
            o_O : true
        ***REMOVED***
    ***REMOVED***);
    t.same(argv.beep, ***REMOVED*** boop : true ***REMOVED***);
    t.end();
***REMOVED***);
