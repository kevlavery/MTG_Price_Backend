/*!
 * destroy
 * Copyright(c) 2014 Jonathan Ong
 * MIT Licensed
 */

'use strict'

/**
 * Module dependencies.
 * @private
 */

var ReadStream = require('fs').ReadStream
var Stream = require('stream')

/**
 * Module exports.
 * @public
 */

module.exports = destroy

/**
 * Destroy a stream.
 *
 * @param ***REMOVED***object***REMOVED*** stream
 * @public
 */

function destroy(stream) ***REMOVED***
  if (stream instanceof ReadStream) ***REMOVED***
    return destroyReadStream(stream)
  ***REMOVED***

  if (!(stream instanceof Stream)) ***REMOVED***
    return stream
  ***REMOVED***

  if (typeof stream.destroy === 'function') ***REMOVED***
    stream.destroy()
  ***REMOVED***

  return stream
***REMOVED***

/**
 * Destroy a ReadStream.
 *
 * @param ***REMOVED***object***REMOVED*** stream
 * @private
 */

function destroyReadStream(stream) ***REMOVED***
  stream.destroy()

  if (typeof stream.close === 'function') ***REMOVED***
    // node.js core bug work-around
    stream.on('open', onOpenClose)
  ***REMOVED***

  return stream
***REMOVED***

/**
 * On open handler to close stream.
 * @private
 */

function onOpenClose() ***REMOVED***
  if (typeof this.fd === 'number') ***REMOVED***
    // actually close down the fd
    this.close()
  ***REMOVED***
***REMOVED***
