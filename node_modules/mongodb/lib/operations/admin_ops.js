'use strict';

const executeCommand = require('./db_ops').executeCommand;
const executeDbAdminCommand = require('./db_ops').executeDbAdminCommand;

/**
 * Get ReplicaSet status
 *
 * @param ***REMOVED***Admin***REMOVED*** a collection instance.
 * @param ***REMOVED***Object***REMOVED*** [options] Optional settings. See Admin.prototype.replSetGetStatus for a list of options.
 * @param ***REMOVED***Admin~resultCallback***REMOVED*** [callback] The command result callback.
 */
function replSetGetStatus(admin, options, callback) ***REMOVED***
  executeDbAdminCommand(admin.s.db, ***REMOVED*** replSetGetStatus: 1 ***REMOVED***, options, callback);
***REMOVED***

/**
 * Retrieve this db's server status.
 *
 * @param ***REMOVED***Admin***REMOVED*** a collection instance.
 * @param ***REMOVED***Object***REMOVED*** [options] Optional settings. See Admin.prototype.serverStatus for a list of options.
 * @param ***REMOVED***Admin~resultCallback***REMOVED*** [callback] The command result callback
 */
function serverStatus(admin, options, callback) ***REMOVED***
  executeDbAdminCommand(admin.s.db, ***REMOVED*** serverStatus: 1 ***REMOVED***, options, callback);
***REMOVED***

/**
 * Validate an existing collection
 *
 * @param ***REMOVED***Admin***REMOVED*** a collection instance.
 * @param ***REMOVED***string***REMOVED*** collectionName The name of the collection to validate.
 * @param ***REMOVED***Object***REMOVED*** [options] Optional settings. See Admin.prototype.validateCollection for a list of options.
 * @param ***REMOVED***Admin~resultCallback***REMOVED*** [callback] The command result callback.
 */
function validateCollection(admin, collectionName, options, callback) ***REMOVED***
  const command = ***REMOVED*** validate: collectionName ***REMOVED***;
  const keys = Object.keys(options);

  // Decorate command with extra options
  for (let i = 0; i < keys.length; i++) ***REMOVED***
    if (options.hasOwnProperty(keys[i]) && keys[i] !== 'session') ***REMOVED***
      command[keys[i]] = options[keys[i]];
    ***REMOVED***
  ***REMOVED***

  executeCommand(admin.s.db, command, options, (err, doc) => ***REMOVED***
    if (err != null) return callback(err, null);

    if (doc.ok === 0) return callback(new Error('Error with validate command'), null);
    if (doc.result != null && doc.result.constructor !== String)
      return callback(new Error('Error with validation data'), null);
    if (doc.result != null && doc.result.match(/exception|corrupt/) != null)
      return callback(new Error('Error: invalid collection ' + collectionName), null);
    if (doc.valid != null && !doc.valid)
      return callback(new Error('Error: invalid collection ' + collectionName), null);

    return callback(null, doc);
  ***REMOVED***);
***REMOVED***

module.exports = ***REMOVED*** replSetGetStatus, serverStatus, validateCollection ***REMOVED***;
