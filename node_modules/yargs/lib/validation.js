// validation-type-stuff, missing params,
// bad implications, custom checks.
module.exports = function (yargs, usage) ***REMOVED***
  var self = ***REMOVED******REMOVED***

  // validate appropriate # of non-option
  // arguments were provided, i.e., '_'.
  self.nonOptionCount = function (argv) ***REMOVED***
    var demanded = yargs.getDemanded()

    if (demanded._ && argv._.length < demanded._.count) ***REMOVED***
      if (demanded._.msg !== undefined) ***REMOVED***
        usage.fail(demanded._.msg)
      ***REMOVED*** else ***REMOVED***
        usage.fail('Not enough non-option arguments: got '
          + argv._.length + ', need at least ' + demanded._.count
        )
      ***REMOVED***
    ***REMOVED***
  ***REMOVED***

  // make sure that any args that require an
  // value (--foo=bar), have a value.
  self.missingArgumentValue = function (argv) ***REMOVED***
    var options = yargs.getOptions(),
      defaultValues = [true, false, '']

    if (options.requiresArg.length > 0) ***REMOVED***
      var missingRequiredArgs = []

      options.requiresArg.forEach(function (key) ***REMOVED***
        var value = argv[key]

        // if a value is explicitly requested,
        // flag argument as missing if it does not
        // look like foo=bar was entered.
        if (~defaultValues.indexOf(value)
        || (Array.isArray(value) && !value.length)) ***REMOVED***
          missingRequiredArgs.push(key)
        ***REMOVED***
      ***REMOVED***)

      if (missingRequiredArgs.length === 1) ***REMOVED***
        usage.fail('Missing argument value: ' + missingRequiredArgs[0])
      ***REMOVED*** else if (missingRequiredArgs.length > 1) ***REMOVED***
        var message = 'Missing argument values: ' + missingRequiredArgs.join(', ')
        usage.fail(message)
      ***REMOVED***
    ***REMOVED***
  ***REMOVED***

  // make sure all the required arguments are present.
  self.requiredArguments = function (argv) ***REMOVED***
    var demanded = yargs.getDemanded(),
      missing = null

    Object.keys(demanded).forEach(function (key) ***REMOVED***
      if (!argv.hasOwnProperty(key)) ***REMOVED***
        missing = missing || ***REMOVED******REMOVED***
        missing[key] = demanded[key]
      ***REMOVED***
    ***REMOVED***)

    if (missing) ***REMOVED***
      var customMsgs = []
      Object.keys(missing).forEach(function (key) ***REMOVED***
        var msg = missing[key].msg
        if (msg && customMsgs.indexOf(msg) < 0) ***REMOVED***
          customMsgs.push(msg)
        ***REMOVED***
      ***REMOVED***)

      var customMsg = customMsgs.length ? '\n' + customMsgs.join('\n') : ''
      usage.fail('Missing required arguments: ' + Object.keys(missing).join(', ') + customMsg)
    ***REMOVED***
  ***REMOVED***

  // check for unknown arguments (strict-mode).
  self.unknownArguments = function (argv, aliases) ***REMOVED***
    var descriptions = usage.getDescriptions(),
      demanded = yargs.getDemanded(),
      unknown = [],
      aliasLookup = ***REMOVED******REMOVED***

    Object.keys(aliases).forEach(function (key) ***REMOVED***
      aliases[key].forEach(function (alias) ***REMOVED***
        aliasLookup[alias] = key
      ***REMOVED***)
    ***REMOVED***)

    Object.keys(argv).forEach(function (key) ***REMOVED***
      if (key !== '$0' && key !== '_' &&
        !descriptions.hasOwnProperty(key) &&
        !demanded.hasOwnProperty(key) &&
        !aliasLookup.hasOwnProperty(key)) ***REMOVED***
        unknown.push(key)
      ***REMOVED***
    ***REMOVED***)

    if (unknown.length === 1) ***REMOVED***
      usage.fail('Unknown argument: ' + unknown[0])
    ***REMOVED*** else if (unknown.length > 1) ***REMOVED***
      usage.fail('Unknown arguments: ' + unknown.join(', '))
    ***REMOVED***
  ***REMOVED***

  // custom checks, added using the `check` option on yargs.
  var checks = []
  self.check = function (f) ***REMOVED***
    checks.push(f)
  ***REMOVED***

  self.customChecks = function (argv, aliases) ***REMOVED***
    checks.forEach(function (f) ***REMOVED***
      try ***REMOVED***
        var result = f(argv, aliases)
        if (!result) ***REMOVED***
          usage.fail('Argument check failed: ' + f.toString())
        ***REMOVED*** else if (typeof result === 'string') ***REMOVED***
          usage.fail(result)
        ***REMOVED***
      ***REMOVED*** catch (err) ***REMOVED***
        usage.fail(err.message ? err.message : err)
      ***REMOVED***
    ***REMOVED***)
  ***REMOVED***

  // check implications, argument foo implies => argument bar.
  var implied = ***REMOVED******REMOVED***
  self.implies = function (key, value) ***REMOVED***
    if (typeof key === 'object') ***REMOVED***
      Object.keys(key).forEach(function (k) ***REMOVED***
        self.implies(k, key[k])
      ***REMOVED***)
    ***REMOVED*** else ***REMOVED***
      implied[key] = value
    ***REMOVED***
  ***REMOVED***
  self.getImplied = function () ***REMOVED***
    return implied
  ***REMOVED***

  self.implications = function (argv) ***REMOVED***
    var implyFail = []

    Object.keys(implied).forEach(function (key) ***REMOVED***
      var num,
        origKey = key,
        value = implied[key]

      // convert string '1' to number 1
      num = Number(key)
      key = isNaN(num) ? key : num

      if (typeof key === 'number') ***REMOVED***
        // check length of argv._
        key = argv._.length >= key
      ***REMOVED*** else if (key.match(/^--no-.+/)) ***REMOVED***
        // check if key doesn't exist
        key = key.match(/^--no-(.+)/)[1]
        key = !argv[key]
      ***REMOVED*** else ***REMOVED***
        // check if key exists
        key = argv[key]
      ***REMOVED***

      num = Number(value)
      value = isNaN(num) ? value : num

      if (typeof value === 'number') ***REMOVED***
        value = argv._.length >= value
      ***REMOVED*** else if (value.match(/^--no-.+/)) ***REMOVED***
        value = value.match(/^--no-(.+)/)[1]
        value = !argv[value]
      ***REMOVED*** else ***REMOVED***
        value = argv[value]
      ***REMOVED***

      if (key && !value) ***REMOVED***
        implyFail.push(origKey)
      ***REMOVED***
    ***REMOVED***)

    if (implyFail.length) ***REMOVED***
      var msg = 'Implications failed:\n'

      implyFail.forEach(function (key) ***REMOVED***
        msg += ('  ' + key + ' -> ' + implied[key])
      ***REMOVED***)

      usage.fail(msg)
    ***REMOVED***
  ***REMOVED***

  return self
***REMOVED***
