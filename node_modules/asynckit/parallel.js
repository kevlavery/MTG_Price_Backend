var iterate    = require('./lib/iterate.js')
  , initState  = require('./lib/state.js')
  , terminator = require('./lib/terminator.js')
  ;

// Public API
module.exports = parallel;

/**
 * Runs iterator over provided array elements in parallel
 *
 * @param   ***REMOVED***array|object***REMOVED*** list - array or object (named list) to iterate over
 * @param   ***REMOVED***function***REMOVED*** iterator - iterator to run
 * @param   ***REMOVED***function***REMOVED*** callback - invoked when all elements processed
 * @returns ***REMOVED***function***REMOVED*** - jobs terminator
 */
function parallel(list, iterator, callback)
***REMOVED***
  var state = initState(list);

  while (state.index < (state['keyedList'] || list).length)
  ***REMOVED***
    iterate(list, iterator, state, function(error, result)
    ***REMOVED***
      if (error)
      ***REMOVED***
        callback(error, result);
        return;
      ***REMOVED***

      // looks like it's the last one
      if (Object.keys(state.jobs).length === 0)
      ***REMOVED***
        callback(null, state.results);
        return;
      ***REMOVED***
    ***REMOVED***);

    state.index++;
  ***REMOVED***

  return terminator.bind(state, callback);
***REMOVED***
