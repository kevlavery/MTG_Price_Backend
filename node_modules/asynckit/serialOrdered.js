var iterate    = require('./lib/iterate.js')
  , initState  = require('./lib/state.js')
  , terminator = require('./lib/terminator.js')
  ;

// Public API
module.exports = serialOrdered;
// sorting helpers
module.exports.ascending  = ascending;
module.exports.descending = descending;

/**
 * Runs iterator over provided sorted array elements in series
 *
 * @param   ***REMOVED***array|object***REMOVED*** list - array or object (named list) to iterate over
 * @param   ***REMOVED***function***REMOVED*** iterator - iterator to run
 * @param   ***REMOVED***function***REMOVED*** sortMethod - custom sort function
 * @param   ***REMOVED***function***REMOVED*** callback - invoked when all elements processed
 * @returns ***REMOVED***function***REMOVED*** - jobs terminator
 */
function serialOrdered(list, iterator, sortMethod, callback)
***REMOVED***
  var state = initState(list, sortMethod);

  iterate(list, iterator, state, function iteratorHandler(error, result)
  ***REMOVED***
    if (error)
    ***REMOVED***
      callback(error, result);
      return;
    ***REMOVED***

    state.index++;

    // are we there yet?
    if (state.index < (state['keyedList'] || list).length)
    ***REMOVED***
      iterate(list, iterator, state, iteratorHandler);
      return;
    ***REMOVED***

    // done here
    callback(null, state.results);
  ***REMOVED***);

  return terminator.bind(state, callback);
***REMOVED***

/*
 * -- Sort methods
 */

/**
 * sort helper to sort array elements in ascending order
 *
 * @param   ***REMOVED***mixed***REMOVED*** a - an item to compare
 * @param   ***REMOVED***mixed***REMOVED*** b - an item to compare
 * @returns ***REMOVED***number***REMOVED*** - comparison result
 */
function ascending(a, b)
***REMOVED***
  return a < b ? -1 : a > b ? 1 : 0;
***REMOVED***

/**
 * sort helper to sort array elements in descending order
 *
 * @param   ***REMOVED***mixed***REMOVED*** a - an item to compare
 * @param   ***REMOVED***mixed***REMOVED*** b - an item to compare
 * @returns ***REMOVED***number***REMOVED*** - comparison result
 */
function descending(a, b)
***REMOVED***
  return -1 * ascending(a, b);
***REMOVED***
