/*!
 * express
 * Copyright(c) 2009-2013 TJ Holowaychuk
 * Copyright(c) 2013 Roman Shtylman
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */

'use strict';

/**
 * Module dependencies.
 */

var merge = require('utils-merge')
var parseUrl = require('parseurl');
var qs = require('qs');

/**
 * @param ***REMOVED***Object***REMOVED*** options
 * @return ***REMOVED***Function***REMOVED***
 * @api public
 */

module.exports = function query(options) ***REMOVED***
  var opts = merge(***REMOVED******REMOVED***, options)
  var queryparse = qs.parse;

  if (typeof options === 'function') ***REMOVED***
    queryparse = options;
    opts = undefined;
  ***REMOVED***

  if (opts !== undefined && opts.allowPrototypes === undefined) ***REMOVED***
    // back-compat for qs module
    opts.allowPrototypes = true;
  ***REMOVED***

  return function query(req, res, next)***REMOVED***
    if (!req.query) ***REMOVED***
      var val = parseUrl(req).query;
      req.query = queryparse(val, opts);
    ***REMOVED***

    next();
  ***REMOVED***;
***REMOVED***;
