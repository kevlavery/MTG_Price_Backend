diff --git a/lib/util.js b/lib/util.js
index a03e874..9074e8e 100644
--- a/lib/util.js
+++ b/lib/util.js
@@ -19,430 +19,6 @@
 // OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
 // USE OR OTHER DEALINGS IN THE SOFTWARE.

-var formatRegExp = /%[sdj%]/g;
-exports.format = function(f) ***REMOVED***
-  if (!isString(f)) ***REMOVED***
-    var objects = [];
-    for (var i = 0; i < arguments.length; i++) ***REMOVED***
-      objects.push(inspect(arguments[i]));
-    ***REMOVED***
-    return objects.join(' ');
-  ***REMOVED***
-
-  var i = 1;
-  var args = arguments;
-  var len = args.length;
-  var str = String(f).replace(formatRegExp, function(x) ***REMOVED***
-    if (x === '%%') return '%';
-    if (i >= len) return x;
-    switch (x) ***REMOVED***
-      case '%s': return String(args[i++]);
-      case '%d': return Number(args[i++]);
-      case '%j':
-        try ***REMOVED***
-          return JSON.stringify(args[i++]);
-        ***REMOVED*** catch (_) ***REMOVED***
-          return '[Circular]';
-        ***REMOVED***
-      default:
-        return x;
-    ***REMOVED***
-  ***REMOVED***);
-  for (var x = args[i]; i < len; x = args[++i]) ***REMOVED***
-    if (isNull(x) || !isObject(x)) ***REMOVED***
-      str += ' ' + x;
-    ***REMOVED*** else ***REMOVED***
-      str += ' ' + inspect(x);
-    ***REMOVED***
-  ***REMOVED***
-  return str;
-***REMOVED***;
-
-
-// Mark that a method should not be used.
-// Returns a modified function which warns once by default.
-// If --no-deprecation is set, then it is a no-op.
-exports.deprecate = function(fn, msg) ***REMOVED***
-  // Allow for deprecating things in the process of starting up.
-  if (isUndefined(global.process)) ***REMOVED***
-    return function() ***REMOVED***
-      return exports.deprecate(fn, msg).apply(this, arguments);
-    ***REMOVED***;
-  ***REMOVED***
-
-  if (process.noDeprecation === true) ***REMOVED***
-    return fn;
-  ***REMOVED***
-
-  var warned = false;
-  function deprecated() ***REMOVED***
-    if (!warned) ***REMOVED***
-      if (process.throwDeprecation) ***REMOVED***
-        throw new Error(msg);
-      ***REMOVED*** else if (process.traceDeprecation) ***REMOVED***
-        console.trace(msg);
-      ***REMOVED*** else ***REMOVED***
-        console.error(msg);
-      ***REMOVED***
-      warned = true;
-    ***REMOVED***
-    return fn.apply(this, arguments);
-  ***REMOVED***
-
-  return deprecated;
-***REMOVED***;
-
-
-var debugs = ***REMOVED******REMOVED***;
-var debugEnviron;
-exports.debuglog = function(set) ***REMOVED***
-  if (isUndefined(debugEnviron))
-    debugEnviron = process.env.NODE_DEBUG || '';
-  set = set.toUpperCase();
-  if (!debugs[set]) ***REMOVED***
-    if (new RegExp('\\b' + set + '\\b', 'i').test(debugEnviron)) ***REMOVED***
-      var pid = process.pid;
-      debugs[set] = function() ***REMOVED***
-        var msg = exports.format.apply(exports, arguments);
-        console.error('%s %d: %s', set, pid, msg);
-      ***REMOVED***;
-    ***REMOVED*** else ***REMOVED***
-      debugs[set] = function() ***REMOVED******REMOVED***;
-    ***REMOVED***
-  ***REMOVED***
-  return debugs[set];
-***REMOVED***;
-
-
-/**
- * Echos the value of a value. Trys to print the value out
- * in the best way possible given the different types.
- *
- * @param ***REMOVED***Object***REMOVED*** obj The object to print out.
- * @param ***REMOVED***Object***REMOVED*** opts Optional options object that alters the output.
- */
-/* legacy: obj, showHidden, depth, colors*/
-function inspect(obj, opts) ***REMOVED***
-  // default options
-  var ctx = ***REMOVED***
-    seen: [],
-    stylize: stylizeNoColor
-  ***REMOVED***;
-  // legacy...
-  if (arguments.length >= 3) ctx.depth = arguments[2];
-  if (arguments.length >= 4) ctx.colors = arguments[3];
-  if (isBoolean(opts)) ***REMOVED***
-    // legacy...
-    ctx.showHidden = opts;
-  ***REMOVED*** else if (opts) ***REMOVED***
-    // got an "options" object
-    exports._extend(ctx, opts);
-  ***REMOVED***
-  // set default options
-  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;
-  if (isUndefined(ctx.depth)) ctx.depth = 2;
-  if (isUndefined(ctx.colors)) ctx.colors = false;
-  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;
-  if (ctx.colors) ctx.stylize = stylizeWithColor;
-  return formatValue(ctx, obj, ctx.depth);
-***REMOVED***
-exports.inspect = inspect;
-
-
-// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics
-inspect.colors = ***REMOVED***
-  'bold' : [1, 22],
-  'italic' : [3, 23],
-  'underline' : [4, 24],
-  'inverse' : [7, 27],
-  'white' : [37, 39],
-  'grey' : [90, 39],
-  'black' : [30, 39],
-  'blue' : [34, 39],
-  'cyan' : [36, 39],
-  'green' : [32, 39],
-  'magenta' : [35, 39],
-  'red' : [31, 39],
-  'yellow' : [33, 39]
-***REMOVED***;
-
-// Don't use 'blue' not visible on cmd.exe
-inspect.styles = ***REMOVED***
-  'special': 'cyan',
-  'number': 'yellow',
-  'boolean': 'yellow',
-  'undefined': 'grey',
-  'null': 'bold',
-  'string': 'green',
-  'date': 'magenta',
-  // "name": intentionally not styling
-  'regexp': 'red'
-***REMOVED***;
-
-
-function stylizeWithColor(str, styleType) ***REMOVED***
-  var style = inspect.styles[styleType];
-
-  if (style) ***REMOVED***
-    return '\u001b[' + inspect.colors[style][0] + 'm' + str +
-           '\u001b[' + inspect.colors[style][1] + 'm';
-  ***REMOVED*** else ***REMOVED***
-    return str;
-  ***REMOVED***
-***REMOVED***
-
-
-function stylizeNoColor(str, styleType) ***REMOVED***
-  return str;
-***REMOVED***
-
-
-function arrayToHash(array) ***REMOVED***
-  var hash = ***REMOVED******REMOVED***;
-
-  array.forEach(function(val, idx) ***REMOVED***
-    hash[val] = true;
-  ***REMOVED***);
-
-  return hash;
-***REMOVED***
-
-
-function formatValue(ctx, value, recurseTimes) ***REMOVED***
-  // Provide a hook for user-specified inspect functions.
-  // Check that value is an object with an inspect function on it
-  if (ctx.customInspect &&
-      value &&
-      isFunction(value.inspect) &&
-      // Filter out the util module, it's inspect function is special
-      value.inspect !== exports.inspect &&
-      // Also filter out any prototype objects using the circular check.
-      !(value.constructor && value.constructor.prototype === value)) ***REMOVED***
-    var ret = value.inspect(recurseTimes, ctx);
-    if (!isString(ret)) ***REMOVED***
-      ret = formatValue(ctx, ret, recurseTimes);
-    ***REMOVED***
-    return ret;
-  ***REMOVED***
-
-  // Primitive types cannot have properties
-  var primitive = formatPrimitive(ctx, value);
-  if (primitive) ***REMOVED***
-    return primitive;
-  ***REMOVED***
-
-  // Look up the keys of the object.
-  var keys = Object.keys(value);
-  var visibleKeys = arrayToHash(keys);
-
-  if (ctx.showHidden) ***REMOVED***
-    keys = Object.getOwnPropertyNames(value);
-  ***REMOVED***
-
-  // Some type of object without properties can be shortcutted.
-  if (keys.length === 0) ***REMOVED***
-    if (isFunction(value)) ***REMOVED***
-      var name = value.name ? ': ' + value.name : '';
-      return ctx.stylize('[Function' + name + ']', 'special');
-    ***REMOVED***
-    if (isRegExp(value)) ***REMOVED***
-      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
-    ***REMOVED***
-    if (isDate(value)) ***REMOVED***
-      return ctx.stylize(Date.prototype.toString.call(value), 'date');
-    ***REMOVED***
-    if (isError(value)) ***REMOVED***
-      return formatError(value);
-    ***REMOVED***
-  ***REMOVED***
-
-  var base = '', array = false, braces = ['***REMOVED***', '***REMOVED***'];
-
-  // Make Array say that they are Array
-  if (isArray(value)) ***REMOVED***
-    array = true;
-    braces = ['[', ']'];
-  ***REMOVED***
-
-  // Make functions say that they are functions
-  if (isFunction(value)) ***REMOVED***
-    var n = value.name ? ': ' + value.name : '';
-    base = ' [Function' + n + ']';
-  ***REMOVED***
-
-  // Make RegExps say that they are RegExps
-  if (isRegExp(value)) ***REMOVED***
-    base = ' ' + RegExp.prototype.toString.call(value);
-  ***REMOVED***
-
-  // Make dates with properties first say the date
-  if (isDate(value)) ***REMOVED***
-    base = ' ' + Date.prototype.toUTCString.call(value);
-  ***REMOVED***
-
-  // Make error with message first say the error
-  if (isError(value)) ***REMOVED***
-    base = ' ' + formatError(value);
-  ***REMOVED***
-
-  if (keys.length === 0 && (!array || value.length == 0)) ***REMOVED***
-    return braces[0] + base + braces[1];
-  ***REMOVED***
-
-  if (recurseTimes < 0) ***REMOVED***
-    if (isRegExp(value)) ***REMOVED***
-      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');
-    ***REMOVED*** else ***REMOVED***
-      return ctx.stylize('[Object]', 'special');
-    ***REMOVED***
-  ***REMOVED***
-
-  ctx.seen.push(value);
-
-  var output;
-  if (array) ***REMOVED***
-    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);
-  ***REMOVED*** else ***REMOVED***
-    output = keys.map(function(key) ***REMOVED***
-      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);
-    ***REMOVED***);
-  ***REMOVED***
-
-  ctx.seen.pop();
-
-  return reduceToSingleString(output, base, braces);
-***REMOVED***
-
-
-function formatPrimitive(ctx, value) ***REMOVED***
-  if (isUndefined(value))
-    return ctx.stylize('undefined', 'undefined');
-  if (isString(value)) ***REMOVED***
-    var simple = '\'' + JSON.stringify(value).replace(/^"|"$/g, '')
-                                             .replace(/'/g, "\\'")
-                                             .replace(/\\"/g, '"') + '\'';
-    return ctx.stylize(simple, 'string');
-  ***REMOVED***
-  if (isNumber(value)) ***REMOVED***
-    // Format -0 as '-0'. Strict equality won't distinguish 0 from -0,
-    // so instead we use the fact that 1 / -0 < 0 whereas 1 / 0 > 0 .
-    if (value === 0 && 1 / value < 0)
-      return ctx.stylize('-0', 'number');
-    return ctx.stylize('' + value, 'number');
-  ***REMOVED***
-  if (isBoolean(value))
-    return ctx.stylize('' + value, 'boolean');
-  // For some reason typeof null is "object", so special case here.
-  if (isNull(value))
-    return ctx.stylize('null', 'null');
-***REMOVED***
-
-
-function formatError(value) ***REMOVED***
-  return '[' + Error.prototype.toString.call(value) + ']';
-***REMOVED***
-
-
-function formatArray(ctx, value, recurseTimes, visibleKeys, keys) ***REMOVED***
-  var output = [];
-  for (var i = 0, l = value.length; i < l; ++i) ***REMOVED***
-    if (hasOwnProperty(value, String(i))) ***REMOVED***
-      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
-          String(i), true));
-    ***REMOVED*** else ***REMOVED***
-      output.push('');
-    ***REMOVED***
-  ***REMOVED***
-  keys.forEach(function(key) ***REMOVED***
-    if (!key.match(/^\d+$/)) ***REMOVED***
-      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,
-          key, true));
-    ***REMOVED***
-  ***REMOVED***);
-  return output;
-***REMOVED***
-
-
-function formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) ***REMOVED***
-  var name, str, desc;
-  desc = Object.getOwnPropertyDescriptor(value, key) || ***REMOVED*** value: value[key] ***REMOVED***;
-  if (desc.get) ***REMOVED***
-    if (desc.set) ***REMOVED***
-      str = ctx.stylize('[Getter/Setter]', 'special');
-    ***REMOVED*** else ***REMOVED***
-      str = ctx.stylize('[Getter]', 'special');
-    ***REMOVED***
-  ***REMOVED*** else ***REMOVED***
-    if (desc.set) ***REMOVED***
-      str = ctx.stylize('[Setter]', 'special');
-    ***REMOVED***
-  ***REMOVED***
-  if (!hasOwnProperty(visibleKeys, key)) ***REMOVED***
-    name = '[' + key + ']';
-  ***REMOVED***
-  if (!str) ***REMOVED***
-    if (ctx.seen.indexOf(desc.value) < 0) ***REMOVED***
-      if (isNull(recurseTimes)) ***REMOVED***
-        str = formatValue(ctx, desc.value, null);
-      ***REMOVED*** else ***REMOVED***
-        str = formatValue(ctx, desc.value, recurseTimes - 1);
-      ***REMOVED***
-      if (str.indexOf('\n') > -1) ***REMOVED***
-        if (array) ***REMOVED***
-          str = str.split('\n').map(function(line) ***REMOVED***
-            return '  ' + line;
-          ***REMOVED***).join('\n').substr(2);
-        ***REMOVED*** else ***REMOVED***
-          str = '\n' + str.split('\n').map(function(line) ***REMOVED***
-            return '   ' + line;
-          ***REMOVED***).join('\n');
-        ***REMOVED***
-      ***REMOVED***
-    ***REMOVED*** else ***REMOVED***
-      str = ctx.stylize('[Circular]', 'special');
-    ***REMOVED***
-  ***REMOVED***
-  if (isUndefined(name)) ***REMOVED***
-    if (array && key.match(/^\d+$/)) ***REMOVED***
-      return str;
-    ***REMOVED***
-    name = JSON.stringify('' + key);
-    if (name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)) ***REMOVED***
-      name = name.substr(1, name.length - 2);
-      name = ctx.stylize(name, 'name');
-    ***REMOVED*** else ***REMOVED***
-      name = name.replace(/'/g, "\\'")
-                 .replace(/\\"/g, '"')
-                 .replace(/(^"|"$)/g, "'");
-      name = ctx.stylize(name, 'string');
-    ***REMOVED***
-  ***REMOVED***
-
-  return name + ': ' + str;
-***REMOVED***
-
-
-function reduceToSingleString(output, base, braces) ***REMOVED***
-  var numLinesEst = 0;
-  var length = output.reduce(function(prev, cur) ***REMOVED***
-    numLinesEst++;
-    if (cur.indexOf('\n') >= 0) numLinesEst++;
-    return prev + cur.replace(/\u001b\[\d\d?m/g, '').length + 1;
-  ***REMOVED***, 0);
-
-  if (length > 60) ***REMOVED***
-    return braces[0] +
-           (base === '' ? '' : base + '\n ') +
-           ' ' +
-           output.join(',\n  ') +
-           ' ' +
-           braces[1];
-  ***REMOVED***
-
-  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];
-***REMOVED***
-
-
 // NOTE: These type checking functions intentionally don't use `instanceof`
 // because it is fragile and can be easily faked with `Object.create()`.
 function isArray(ar) ***REMOVED***
@@ -522,166 +98,10 @@ function isPrimitive(arg) ***REMOVED***
 exports.isPrimitive = isPrimitive;

 function isBuffer(arg) ***REMOVED***
-  return arg instanceof Buffer;
+  return Buffer.isBuffer(arg);
 ***REMOVED***
 exports.isBuffer = isBuffer;

 function objectToString(o) ***REMOVED***
   return Object.prototype.toString.call(o);
-***REMOVED***
-
-
-function pad(n) ***REMOVED***
-  return n < 10 ? '0' + n.toString(10) : n.toString(10);
-***REMOVED***
-
-
-var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',
-              'Oct', 'Nov', 'Dec'];
-
-// 26 Feb 16:19:34
-function timestamp() ***REMOVED***
-  var d = new Date();
-  var time = [pad(d.getHours()),
-              pad(d.getMinutes()),
-              pad(d.getSeconds())].join(':');
-  return [d.getDate(), months[d.getMonth()], time].join(' ');
-***REMOVED***
-
-
-// log is just a thin wrapper to console.log that prepends a timestamp
-exports.log = function() ***REMOVED***
-  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));
-***REMOVED***;
-
-
-/**
- * Inherit the prototype methods from one constructor into another.
- *
- * The Function.prototype.inherits from lang.js rewritten as a standalone
- * function (not on Function.prototype). NOTE: If this file is to be loaded
- * during bootstrapping this function needs to be rewritten using some native
- * functions as prototype setup using normal JavaScript does not work as
- * expected during bootstrapping (see mirror.js in r114903).
- *
- * @param ***REMOVED***function***REMOVED*** ctor Constructor function which needs to inherit the
- *     prototype.
- * @param ***REMOVED***function***REMOVED*** superCtor Constructor function to inherit prototype from.
- */
-exports.inherits = function(ctor, superCtor) ***REMOVED***
-  ctor.super_ = superCtor;
-  ctor.prototype = Object.create(superCtor.prototype, ***REMOVED***
-    constructor: ***REMOVED***
-      value: ctor,
-      enumerable: false,
-      writable: true,
-      configurable: true
-    ***REMOVED***
-  ***REMOVED***);
-***REMOVED***;
-
-exports._extend = function(origin, add) ***REMOVED***
-  // Don't do anything if add isn't an object
-  if (!add || !isObject(add)) return origin;
-
-  var keys = Object.keys(add);
-  var i = keys.length;
-  while (i--) ***REMOVED***
-    origin[keys[i]] = add[keys[i]];
-  ***REMOVED***
-  return origin;
-***REMOVED***;
-
-function hasOwnProperty(obj, prop) ***REMOVED***
-  return Object.prototype.hasOwnProperty.call(obj, prop);
-***REMOVED***
-
-
-// Deprecated old stuff.
-
-exports.p = exports.deprecate(function() ***REMOVED***
-  for (var i = 0, len = arguments.length; i < len; ++i) ***REMOVED***
-    console.error(exports.inspect(arguments[i]));
-  ***REMOVED***
-***REMOVED***, 'util.p: Use console.error() instead');
-
-
-exports.exec = exports.deprecate(function() ***REMOVED***
-  return require('child_process').exec.apply(this, arguments);
-***REMOVED***, 'util.exec is now called `child_process.exec`.');
-
-
-exports.print = exports.deprecate(function() ***REMOVED***
-  for (var i = 0, len = arguments.length; i < len; ++i) ***REMOVED***
-    process.stdout.write(String(arguments[i]));
-  ***REMOVED***
-***REMOVED***, 'util.print: Use console.log instead');
-
-
-exports.puts = exports.deprecate(function() ***REMOVED***
-  for (var i = 0, len = arguments.length; i < len; ++i) ***REMOVED***
-    process.stdout.write(arguments[i] + '\n');
-  ***REMOVED***
-***REMOVED***, 'util.puts: Use console.log instead');
-
-
-exports.debug = exports.deprecate(function(x) ***REMOVED***
-  process.stderr.write('DEBUG: ' + x + '\n');
-***REMOVED***, 'util.debug: Use console.error instead');
-
-
-exports.error = exports.deprecate(function(x) ***REMOVED***
-  for (var i = 0, len = arguments.length; i < len; ++i) ***REMOVED***
-    process.stderr.write(arguments[i] + '\n');
-  ***REMOVED***
-***REMOVED***, 'util.error: Use console.error instead');
-
-
-exports.pump = exports.deprecate(function(readStream, writeStream, callback) ***REMOVED***
-  var callbackCalled = false;
-
-  function call(a, b, c) ***REMOVED***
-    if (callback && !callbackCalled) ***REMOVED***
-      callback(a, b, c);
-      callbackCalled = true;
-    ***REMOVED***
-  ***REMOVED***
-
-  readStream.addListener('data', function(chunk) ***REMOVED***
-    if (writeStream.write(chunk) === false) readStream.pause();
-  ***REMOVED***);
-
-  writeStream.addListener('drain', function() ***REMOVED***
-    readStream.resume();
-  ***REMOVED***);
-
-  readStream.addListener('end', function() ***REMOVED***
-    writeStream.end();
-  ***REMOVED***);
-
-  readStream.addListener('close', function() ***REMOVED***
-    call();
-  ***REMOVED***);
-
-  readStream.addListener('error', function(err) ***REMOVED***
-    writeStream.end();
-    call(err);
-  ***REMOVED***);
-
-  writeStream.addListener('error', function(err) ***REMOVED***
-    readStream.destroy();
-    call(err);
-  ***REMOVED***);
-***REMOVED***, 'util.pump(): Use readableStream.pipe() instead');
-
-
-var uv;
-exports._errnoException = function(err, syscall) ***REMOVED***
-  if (isUndefined(uv)) uv = process.binding('uv');
-  var errname = uv.errname(err);
-  var e = new Error(syscall + ' ' + errname);
-  e.code = errname;
-  e.errno = errname;
-  e.syscall = syscall;
-  return e;
-***REMOVED***;
+***REMOVED***