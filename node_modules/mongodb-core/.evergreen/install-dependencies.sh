#!/bin/sh
# set -o xtrace   # Write all commands first to stderr
set -o errexit  # Exit the script with error if any of the commands fail

NODE_LTS_NAME=$***REMOVED***NODE_LTS_NAME:-carbon***REMOVED***
NODE_ARTIFACTS_PATH="$***REMOVED***PROJECT_DIRECTORY***REMOVED***/node-artifacts"
NPM_CACHE_DIR="$***REMOVED***NODE_ARTIFACTS_PATH***REMOVED***/npm"
NPM_TMP_DIR="$***REMOVED***NODE_ARTIFATS_PATH***REMOVED***/tmp"

# this needs to be explicitly exported for the nvm install below
export NVM_DIR="$***REMOVED***NODE_ARTIFACTS_PATH***REMOVED***/nvm"

# create node artifacts path if needed
mkdir -p $***REMOVED***NODE_ARTIFACTS_PATH***REMOVED***
mkdir -p $***REMOVED***NPM_CACHE_DIR***REMOVED***
mkdir -p "$***REMOVED***NPM_TMP_DIR***REMOVED***"

# install Node.js
curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.8/install.sh | bash
[ -s "$***REMOVED***NVM_DIR***REMOVED***/nvm.sh" ] && \. "$***REMOVED***NVM_DIR***REMOVED***/nvm.sh"
nvm install --lts=$***REMOVED***NODE_LTS_NAME***REMOVED***

# setup npm cache in a local directory
cat <<EOT > .npmrc
devdir=$***REMOVED***NPM_CACHE_DIR***REMOVED***/.node-gyp
init-module=$***REMOVED***NPM_CACHE_DIR***REMOVED***/.npm-init.js
cache=$***REMOVED***NPM_CACHE_DIR***REMOVED***
tmp=$***REMOVED***NPM_TMP_DIR***REMOVED***
EOT

# install node dependencies
npm install
