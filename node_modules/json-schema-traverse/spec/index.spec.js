'use strict';

var traverse = require('../index');
var assert = require('assert');

describe('json-schema-traverse', function() ***REMOVED***
  var calls;

  beforeEach(function() ***REMOVED***
    calls = [];
  ***REMOVED***);

  it('should traverse all keywords containing schemas recursively', function() ***REMOVED***
    var schema = require('./fixtures/schema').schema;
    var expectedCalls = require('./fixtures/schema').expectedCalls;

    traverse(schema, callback);
    assert.deepStrictEqual(calls, expectedCalls);
  ***REMOVED***);


  describe('allKeys option', function() ***REMOVED***
    var schema = ***REMOVED***
      someObject: ***REMOVED***
        minimum: 1,
        maximum: 2
      ***REMOVED***
    ***REMOVED***;

    it('should traverse objects with allKeys: true option', function() ***REMOVED***
      // schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex
      var expectedCalls = [
        [schema, '', schema, undefined, undefined, undefined, undefined],
        [schema.someObject, '/someObject', schema, '', 'someObject', schema, undefined]
      ];

      traverse(schema, ***REMOVED***allKeys: true***REMOVED***, callback);
      assert.deepStrictEqual(calls, expectedCalls);
    ***REMOVED***);


    it('should NOT traverse objects with allKeys: false option', function() ***REMOVED***
      // schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex
      var expectedCalls = [
        [schema, '', schema, undefined, undefined, undefined, undefined]
      ];

      traverse(schema, ***REMOVED***allKeys: false***REMOVED***, callback);
      assert.deepStrictEqual(calls, expectedCalls);
    ***REMOVED***);


    it('should NOT traverse objects without allKeys option', function() ***REMOVED***
      // schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex
      var expectedCalls = [
        [schema, '', schema, undefined, undefined, undefined, undefined]
      ];

      traverse(schema, callback);
      assert.deepStrictEqual(calls, expectedCalls);
    ***REMOVED***);


    it('should NOT travers objects in standard keywords which value is not a schema', function() ***REMOVED***
      var schema2 = ***REMOVED***
        const: ***REMOVED***foo: 'bar'***REMOVED***,
        enum: ['a', 'b'],
        required: ['foo'],
        another: ***REMOVED***

        ***REMOVED***,
        patternProperties: ***REMOVED******REMOVED***, // will not traverse - no properties
        dependencies: true, // will not traverse - invalid
        properties: ***REMOVED***
          smaller: ***REMOVED***
            type: 'number'
          ***REMOVED***,
          larger: ***REMOVED***
            type: 'number',
            minimum: ***REMOVED***$data: '1/smaller'***REMOVED***
          ***REMOVED***
        ***REMOVED***
      ***REMOVED***;

      // schema, jsonPtr, rootSchema, parentJsonPtr, parentKeyword, parentSchema, keyIndex
      var expectedCalls = [
        [schema2, '', schema2, undefined, undefined, undefined, undefined],
        [schema2.another, '/another', schema2, '', 'another', schema2, undefined],
        [schema2.properties.smaller, '/properties/smaller', schema2, '', 'properties', schema2, 'smaller'],
        [schema2.properties.larger, '/properties/larger', schema2, '', 'properties', schema2, 'larger'],
      ];

      traverse(schema2, ***REMOVED***allKeys: true***REMOVED***, callback);
      assert.deepStrictEqual(calls, expectedCalls);
    ***REMOVED***);
  ***REMOVED***);


  function callback() ***REMOVED***
    calls.push(Array.prototype.slice.call(arguments));
  ***REMOVED***
***REMOVED***);
