var wordwrap = module.exports = function (start, stop, params) ***REMOVED***
    if (typeof start === 'object') ***REMOVED***
        params = start;
        start = params.start;
        stop = params.stop;
    ***REMOVED***
    
    if (typeof stop === 'object') ***REMOVED***
        params = stop;
        start = start || params.start;
        stop = undefined;
    ***REMOVED***
    
    if (!stop) ***REMOVED***
        stop = start;
        start = 0;
    ***REMOVED***
    
    if (!params) params = ***REMOVED******REMOVED***;
    var mode = params.mode || 'soft';
    var re = mode === 'hard' ? /\b/ : /(\S+\s+)/;
    
    return function (text) ***REMOVED***
        var chunks = text.toString()
            .split(re)
            .reduce(function (acc, x) ***REMOVED***
                if (mode === 'hard') ***REMOVED***
                    for (var i = 0; i < x.length; i += stop - start) ***REMOVED***
                        acc.push(x.slice(i, i + stop - start));
                    ***REMOVED***
                ***REMOVED***
                else acc.push(x)
                return acc;
            ***REMOVED***, [])
        ;
        
        return chunks.reduce(function (lines, rawChunk) ***REMOVED***
            if (rawChunk === '') return lines;
            
            var chunk = rawChunk.replace(/\t/g, '    ');
            
            var i = lines.length - 1;
            if (lines[i].length + chunk.length > stop) ***REMOVED***
                lines[i] = lines[i].replace(/\s+$/, '');
                
                chunk.split(/\n/).forEach(function (c) ***REMOVED***
                    lines.push(
                        new Array(start + 1).join(' ')
                        + c.replace(/^\s+/, '')
                    );
                ***REMOVED***);
            ***REMOVED***
            else if (chunk.match(/\n/)) ***REMOVED***
                var xs = chunk.split(/\n/);
                lines[i] += xs.shift();
                xs.forEach(function (c) ***REMOVED***
                    lines.push(
                        new Array(start + 1).join(' ')
                        + c.replace(/^\s+/, '')
                    );
                ***REMOVED***);
            ***REMOVED***
            else ***REMOVED***
                lines[i] += chunk;
            ***REMOVED***
            
            return lines;
        ***REMOVED***, [ new Array(start + 1).join(' ') ]).join('\n');
    ***REMOVED***;
***REMOVED***;

wordwrap.soft = wordwrap;

wordwrap.hard = function (start, stop) ***REMOVED***
    return wordwrap(start, stop, ***REMOVED*** mode : 'hard' ***REMOVED***);
***REMOVED***;
