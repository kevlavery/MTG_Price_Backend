
var mongoose = require('mongoose');
var Schema = mongoose.Schema;

console.log('Running mongoose version %s', mongoose.version);

/**
 * Schema
 */

var CharacterSchema = Schema(***REMOVED***
  name: ***REMOVED***
    type: String,
    required: true
  ***REMOVED***,
  health: ***REMOVED***
    type: Number,
    min: 0,
    max: 100
  ***REMOVED***
***REMOVED***);

/**
 * Methods
 */

CharacterSchema.methods.attack = function() ***REMOVED***
  console.log('%s is attacking', this.name);
***REMOVED***;

/**
 * Character model
 */

var Character = mongoose.model('Character', CharacterSchema);

/**
 * Connect to the database on localhost with
 * the default port (27017)
 */

var dbname = 'mongoose-example-doc-methods-' + ((Math.random() * 10000) | 0);
var uri = 'mongodb://localhost/' + dbname;

console.log('connecting to %s', uri);

mongoose.connect(uri, function(err) ***REMOVED***
  // if we failed to connect, abort
  if (err) throw err;

  // we connected ok
  example();
***REMOVED***);

/**
 * Use case
 */

function example() ***REMOVED***
  Character.create(***REMOVED***name: 'Link', health: 100***REMOVED***, function(err, link) ***REMOVED***
    if (err) return done(err);
    console.log('found', link);
    link.attack(); // 'Link is attacking'
    done();
  ***REMOVED***);
***REMOVED***

/**
 * Clean up
 */

function done(err) ***REMOVED***
  if (err) console.error(err);
  mongoose.connection.db.dropDatabase(function() ***REMOVED***
    mongoose.disconnect();
  ***REMOVED***);
***REMOVED***
