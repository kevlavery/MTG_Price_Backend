'use strict';

Object.defineProperty(exports, "__esModule", ***REMOVED***
    value: true
***REMOVED***);

var _noop = require('lodash/noop');

var _noop2 = _interopRequireDefault(_noop);

var _rest = require('./internal/rest');

var _rest2 = _interopRequireDefault(_rest);

var _reduce = require('./reduce');

var _reduce2 = _interopRequireDefault(_reduce);

function _interopRequireDefault(obj) ***REMOVED*** return obj && obj.__esModule ? obj : ***REMOVED*** default: obj ***REMOVED***; ***REMOVED***

/**
 * Version of the compose function that is more natural to read. Each function
 * consumes the return value of the previous function. It is the equivalent of
 * [compose]***REMOVED***@link module:ControlFlow.compose***REMOVED*** with the arguments reversed.
 *
 * Each function is executed with the `this` binding of the composed function.
 *
 * @name seq
 * @static
 * @memberOf module:ControlFlow
 * @method
 * @see [async.compose]***REMOVED***@link module:ControlFlow.compose***REMOVED***
 * @category Control Flow
 * @param ***REMOVED***...Function***REMOVED*** functions - the asynchronous functions to compose
 * @returns ***REMOVED***Function***REMOVED*** a function that composes the `functions` in order
 * @example
 *
 * // Requires lodash (or underscore), express3 and dresende's orm2.
 * // Part of an app, that fetches cats of the logged user.
 * // This example uses `seq` function to avoid overnesting and error
 * // handling clutter.
 * app.get('/cats', function(request, response) ***REMOVED***
 *     var User = request.models.User;
 *     async.seq(
 *         _.bind(User.get, User),  // 'User.get' has signature (id, callback(err, data))
 *         function(user, fn) ***REMOVED***
 *             user.getCats(fn);      // 'getCats' has signature (callback(err, data))
 *         ***REMOVED***
 *     )(req.session.user_id, function (err, cats) ***REMOVED***
 *         if (err) ***REMOVED***
 *             console.error(err);
 *             response.json(***REMOVED*** status: 'error', message: err.message ***REMOVED***);
 *         ***REMOVED*** else ***REMOVED***
 *             response.json(***REMOVED*** status: 'ok', message: 'Cats found', data: cats ***REMOVED***);
 *         ***REMOVED***
 *     ***REMOVED***);
 * ***REMOVED***);
 */
exports.default = (0, _rest2.default)(function seq(functions) ***REMOVED***
    return (0, _rest2.default)(function (args) ***REMOVED***
        var that = this;

        var cb = args[args.length - 1];
        if (typeof cb == 'function') ***REMOVED***
            args.pop();
        ***REMOVED*** else ***REMOVED***
            cb = _noop2.default;
        ***REMOVED***

        (0, _reduce2.default)(functions, args, function (newargs, fn, cb) ***REMOVED***
            fn.apply(that, newargs.concat([(0, _rest2.default)(function (err, nextargs) ***REMOVED***
                cb(err, nextargs);
            ***REMOVED***)]));
        ***REMOVED***, function (err, results) ***REMOVED***
            cb.apply(that, [err].concat(results));
        ***REMOVED***);
    ***REMOVED***);
***REMOVED***);
module.exports = exports['default'];