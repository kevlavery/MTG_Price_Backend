'use strict';

/*!
 * ignore
 */

module.exports = function(schema) ***REMOVED***
  const unshift = true;
  schema.pre('save', false, function(next, options) ***REMOVED***
    var _this = this;
    // Nested docs have their own presave
    if (this.ownerDocument) ***REMOVED***
      return next();
    ***REMOVED***

    var hasValidateBeforeSaveOption = options &&
        (typeof options === 'object') &&
        ('validateBeforeSave' in options);

    var shouldValidate;
    if (hasValidateBeforeSaveOption) ***REMOVED***
      shouldValidate = !!options.validateBeforeSave;
    ***REMOVED*** else ***REMOVED***
      shouldValidate = this.schema.options.validateBeforeSave;
    ***REMOVED***

    // Validate
    if (shouldValidate) ***REMOVED***
      this.validate(function(error) ***REMOVED***
        return _this.schema.s.hooks.execPost('save:error', _this, [ _this], ***REMOVED*** error: error ***REMOVED***, function(error) ***REMOVED***
          next(error);
        ***REMOVED***);
      ***REMOVED***);
    ***REMOVED*** else ***REMOVED***
      next();
    ***REMOVED***
  ***REMOVED***, null, unshift);
***REMOVED***;
